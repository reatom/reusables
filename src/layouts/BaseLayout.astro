---
interface Props {
  title?: string
  description?: string
}

const {
  title = '@reatom/reusables',
  description = 'A jsrepo registry of reatom state management extensions',
} = Astro.props

const pageTitle =
  title === '@reatom/reusables' ? title : `${title} - @reatom/reusables`
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{pageTitle}</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href={`${import.meta.env.BASE_URL}favicon.svg`}
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      .page-wrapper {
        display: flex;
        flex-direction: column;
        min-height: 100dvh;
      }
      .page-content {
        flex: 1;
      }
    </style>
  </head>
  <body>
    <div class="page-wrapper">
      <div class="page-content">
        <slot />
      </div>
    </div>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>

<script>
  function addCopyButtons() {
    document.querySelectorAll('pre').forEach((pre) => {
      if (pre.querySelector('.copy-button')) return

      const button = document.createElement('button')
      button.className = 'copy-button'
      button.textContent = 'Copy'
      button.setAttribute('aria-label', 'Copy code to clipboard')

      button.addEventListener('click', async () => {
        const code = pre.querySelector('code')
        const text = code?.textContent ?? ''

        try {
          await navigator.clipboard.writeText(text)
          button.textContent = 'Copied!'
          button.classList.add('copied')

          setTimeout(() => {
            button.textContent = 'Copy'
            button.classList.remove('copied')
          }, 2000)
        } catch {
          button.textContent = 'Error'
          setTimeout(() => {
            button.textContent = 'Copy'
          }, 2000)
        }
      })

      pre.appendChild(button)
    })
  }

  function initCollapsibleCode() {
    document
      .querySelectorAll('.collapsible-code:not([data-initialized])')
      .forEach((container) => {
        container.setAttribute('data-initialized', 'true')

        const button = container.querySelector('.expand-button') as HTMLElement
        const code = container.querySelector('code')
        const style = getComputedStyle(container)
        const thresholdValue = style
          .getPropertyValue('--collapse-threshold')
          .trim()
        const threshold = thresholdValue ? parseInt(thresholdValue) : 16

        const codeText = code?.textContent || ''
        const lineCount = (codeText.match(/\n/g) || []).length + 1

        if (lineCount < threshold) {
          container.classList.add('no-collapse')
        }

        if (button && !button.hasAttribute('data-bound')) {
          button.setAttribute('data-bound', 'true')
          button.addEventListener('click', () => {
            container.classList.toggle('expanded')
          })
        }
      })
  }

  addCopyButtons()
  initCollapsibleCode()
  document.addEventListener('astro:after-swap', () => {
    addCopyButtons()
    initCollapsibleCode()
  })
  window.addEventListener('tab-change', initCollapsibleCode)
</script>
